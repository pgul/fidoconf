#!/bin/sh

echo "FidoConfig point Setup Tool"
echo "---------------------------"
echo ""
echo "Installation based on a baseDirectory or FHS style?"
read -p "[b/F]> " METHOD
if test ${METHOD} = b; then
   read -p "baseDirectory> " BASEDIR
   SPOOLDIR=${BASEDIR}
   LOGDIR=${BASEDIR}/log 
   MSGBASEDIR=${BASEDIR}/msgBase
else
   BASEDIR=/etc/fido
   SPOOLDIR=/var/spool/fido
   LOGDIR=/var/log/fido
   MSGBASEDIR=${SPOOLDIR}/msgBase
fi

read -p "Your Name> " NAME
read -p "Your Aka>  " AKA
read -p "Location>  " LOCATION
read -p "Name of Uplink> " UPLINK_NAME
read -p "Aka of Uplink>  " UPLINK_AKA
read -p "Password>  " PASSWORD

if test ! -d ${BASEDIR}; then
   mkdir -p ${BASEDIR}
fi

if test -f ${BASEDIR}/config; then
   mv ${BASEDIR}/config ${BASEDIR}/config.old
   echo "Moved existing config to config.old"
fi

echo "Generating config file..."
( echo "# FidoConfig generated by fidoInst"
echo "Name ${NAME}"
echo "Sysop ${NAME}"
echo "Location ${LOCATION}"
echo "Address ${AKA}"
echo "Version 0.14"
echo ""
echo "Link ${UPLINK_NAME}"
echo "AKA ${UPLINK_AKA}"
echo "ourAka ${AKA}"
echo "Password ${PASSWORD}"
echo "autoAreaCreate on"
echo ""
echo "route Crash ${UPLINK_AKA} *"
echo ""
echo "Inbound ${SPOOLDIR}/in"
echo "ProtInbound ${SPOOLDIR}/in.sec"
echo "TempInbound ${SPOOLDIR}/in.tmp"
echo "Outbound ${SPOOLDIR}/out"
echo "TempOutbound ${SPOOLDIR}/out.tmp"
echo "LogFileDir ${LOGDIR}"
echo "DupeHistoryDir ${SPOOLDIR}/dupes"
echo "NodeListDir ${SPOOLDIR}/nodelist"
echo "MsgBaseDir ${MSGBASEDIR}"
echo ""      
echo "NetMailArea NetMailArea ${MSGBASEDIR}/netmail squish"
echo "BadArea     Badarea     ${MSGBASEDIR}/bad     squish"
echo "DupeArea    DupeArea    ${MSGBASEDIR}/dupe    squish"
     ) > ${BASEDIR}/config

echo "Creating necessary directories..."
mkdir -p ${SPOOLDIR}/in
mkdir -p ${SPOOLDIR}/in.sec
mkdir -p ${SPOOLDIR}/in.tmp
mkdir -p ${SPOOLDIR}/out
mkdir -p ${SPOOLDIR}/out.tmp
mkdir -p ${LOGDIR}
mkdir -p ${SPOOLDIR}/dupes
mkdir -p ${SPOOLDIR}/nodelist
mkdir -p ${MSGBASEDIR}

exit 0;
