# common rules for all platforms

VER = 0.9
VERH = 0

LOBJS = common$(OBJ) dirlayer$(OBJ) fidoconfig$(OBJ) line$(OBJ) adcase$(OBJ) dump$(OBJ)
OBJS  = $(LOBJS) $(FCONF2MSGED)$(OBJ) $(FCONF2GOLDED)$(OBJ) $(FCONF2AQUAED)$(OBJ) $(FCONF2FIDOGATE)$(OBJ) $(FCONF2SQUISH)$(OBJ) dumpfcfg$(OBJ) 
ifeq ($(CC), gcc)
OBJS = $(OBJS) $(FECFG2FCONF)$(OBJ) 
endif

commonlibs: $(LIBFIDOCONFIG)$(LIB)

commonprogs:    tparser$(EXE) \
	        $(FCONF2MSGED)$(EXE) \
                $(FCONF2AQUAED)$(EXE) \
		$(FCONF2FIDOGATE)$(EXE) \
	        $(FCONF2GOLDED)$(EXE) \
		$(FCONF2SQUISH)$(EXE) \
                $(FECFG2FCONF)$(EXE) \
                dumpfcfg$(EXE)

$(LIBFIDOCONFIG)$(LIB): $(LOBJS)
	$(AR) $(AR_R) $(LIBFIDOCONFIG)$(LIB) $(LOBJS)

%$(OBJ): %.c
	$(CC) $(COPT) $(CDEFS) $*.c

$(FCONF2MSGED)$(EXE): $(FCONF2MSGED)$(OBJ) $(LIBFIDOCONFIG)$(LIB)
	$(CC) $(LFLAGS) $(FCONF2MSGED)$(OBJ) -o $(FCONF2MSGED)$(EXE) \
	   $(LOPT) $(LINKFIDOCONFIG) $(LINKSMAPI)

$(FCONF2GOLDED)$(EXE): $(FCONF2GOLDED)$(OBJ) $(LIBFIDOCONFIG)$(LIB)
	$(CC) $(LFLAGS) $(FCONF2GOLDED)$(OBJ) -o $(FCONF2GOLDED)$(EXE) \
	  $(LOPT) $(LINKFIDOCONFIG) $(LINKSMAPI)

$(FCONF2AQUAED)$(EXE): $(FCONF2AQUAED)$(OBJ) $(LIBFIDOCONFIG)$(LIB)
	$(CC) $(LFLAGS) $(FCONF2AQUAED)$(OBJ) -o $(FCONF2AQUAED)$(EXE) \
	  $(LOPT) $(LINKFIDOCONFIG) $(LINKSMAPI)

$(FCONF2FIDOGATE)$(EXE): $(FCONF2FIDOGATE)$(OBJ) $(LIBFIDOCONFIG)$(LIB)
	$(CC) $(LFLAGS) $(FCONF2FIDOGATE)$(OBJ) -o $(FCONF2FIDOGATE)$(EXE) \
	          $(LOPT) $(LINKFIDOCONFIG) $(LINKSMAPI)

$(FCONF2SQUISH)$(EXE): $(FCONF2SQUISH)$(OBJ) $(LIBFIDOCONFIG)$(LIB)
	$(CC) $(LFLAGS) $(FCONF2SQUISH)$(OBJ) -o $(FCONF2SQUISH)$(EXE) \
	          $(LOPT) $(LINKFIDOCONFIG) $(LINKSMAPI)

ifeq ($(CC), gcc)
$(FECFG2FCONF)$(EXE): $(FECFG2FCONF)$(OBJ)
	$(CC) -fpack-struct $(FECFG2FCONF)$(OBJ) -o $(FECFG2FCONF)$(EXE)
else
.PHONY: $(FECFG2FCONF)($EXE)
$(FECFG2FCONF)($EXE):
endif


tparser$(EXE): tparser$(OBJ) $(LIBFIDOCONFIG)$(LIB)
	$(CC) $(LFLAGS) tparser$(OBJ) -o tparser$(EXE) \
	  $(LOPT) $(LINKFIDOCONFIG) $(LINKSMAPI)

dumpfcfg$(EXE): dumpfcfg$(OBJ) $(LIBFIDOCONFIG)$(LIB) dump$(OBJ)
	$(CC) $(LFLAGS) dumpfcfg$(OBJ) dump$(OBJ) -o dumpfcfg$(EXE) \
	  $(LOPT) $(LINKFIDOCONFIG) $(LINKSMAPI)

commonclean:
	-$(RM) *~
	-$(RM) *$(OBJ)
	-$(RM) *$(TPU)
	-$(RM) core

commondistclean: clean
	-$(RM) tparser$(EXE)
	-$(RM) $(FCONF2GOLDED)$(EXE)
	-$(RM) $(FCONF2MSGED)$(EXE) 
	-$(RM) $(FCONF2AQUAED)$(EXE)
	-$(RM) $(FCONF2FIDOGATE)$(EXE)
	-$(RM) $(FCONF2SQUISH)$(EXE)
	-$(RM) $(FECFG2FCONF)$(EXE)
	-$(RM) dumpfcfg$(EXE)
	-$(RM) $(LIBFIDOCONFIG)$(LIB)

